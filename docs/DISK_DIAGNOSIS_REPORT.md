# ç£ç›˜I/Oè¯Šæ–­æŠ¥å‘Š

## ğŸ“Š è¯Šæ–­ç»“æœ

### 1. æ–‡ä»¶ç³»ç»Ÿç±»å‹
- **ç±»å‹**: `ext4` (æœ¬åœ°ç›˜ï¼Œ**ä¸æ˜¯NFSç½‘ç»œç›˜**)
- **è®¾å¤‡**: `/dev/sdb1`
- **æŒ‚è½½ç‚¹**: `/home`
- **å®¹é‡**: 11TBï¼Œå·²ç”¨ 9.9TB (97% ä½¿ç”¨ç‡)
- **å¯ç”¨ç©ºé—´**: 421GB

### 2. ç£ç›˜è¯»å–é€Ÿåº¦æµ‹è¯•
- **æµ‹è¯•æ–‡ä»¶**: `sa1b_shard_00000.tar` (9.9GB)
- **å®é™…è¯»å–é€Ÿåº¦**: **4-5 MB/s** âš ï¸
- **æ­£å¸¸SSDé€Ÿåº¦**: 500+ MB/s
- **æ­£å¸¸HDDé€Ÿåº¦**: 100-200 MB/s
- **ç»“è®º**: **ç£ç›˜è¯»å–é€Ÿåº¦ææ…¢ï¼Œå­˜åœ¨ä¸¥é‡ç“¶é¢ˆ**

### 3. ç³»ç»Ÿç›‘æ§ï¼ˆä¹‹å‰çš„æ•°æ®ï¼‰
- **ç£ç›˜åˆ©ç”¨ç‡**: 99.6% (sdbè®¾å¤‡)
- **I/Oç­‰å¾…æ—¶é—´**: 41-70% (wa)
- **ç³»ç»Ÿè´Ÿè½½**: 136 (Load Average)
- **ç£ç›˜é˜Ÿåˆ—é•¿åº¦**: 225 (avgqu-sz)

## ğŸ” é—®é¢˜åˆ†æ

### ä¸ºä»€ä¹ˆè¿™ä¹ˆæ…¢ï¼Ÿ

1. **ç£ç›˜å‡ ä¹æ»¡äº†** (97%ä½¿ç”¨ç‡)
   - æ–‡ä»¶ç³»ç»Ÿç¢ç‰‡åŒ–ä¸¥é‡
   - å¯ç”¨ç©ºé—´ä¸è¶³å½±å“æ€§èƒ½

2. **æœºæ¢°ç¡¬ç›˜ + é«˜å¹¶å‘I/O**
   - è™½ç„¶æ–‡ä»¶ç³»ç»Ÿæ˜¯ext4æœ¬åœ°ç›˜ï¼Œä½†å¾ˆå¯èƒ½æ˜¯æœºæ¢°ç¡¬ç›˜é˜µåˆ—
   - å¤šä¸ªworkeråŒæ—¶è¯»å–æ—¶ï¼Œç£å¤´æ¥å›å¯»é“ï¼Œæ•ˆç‡æä½
   - 24ä¸ªworkeråŒæ—¶è®¿é—® â†’ ç£å¤´ç–¯ç‹‚å¯»é“ â†’ å®é™…ååé‡æš´è·Œ

3. **I/Oç«äº‰ä¸¥é‡**
   - ç£ç›˜é˜Ÿåˆ—é•¿åº¦225ï¼Œè¯´æ˜å¤§é‡I/Oè¯·æ±‚åœ¨æ’é˜Ÿ
   - å¤šä¸ªè®­ç»ƒä»»åŠ¡åŒæ—¶è¿è¡Œï¼Œäº’ç›¸ç«äº‰ç£ç›˜èµ„æº

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šé™ä½å¹¶å‘æ•°ï¼ˆç«‹å³ç”Ÿæ•ˆï¼Œæ¨èï¼‰

**ä¿®æ”¹è®­ç»ƒå‚æ•°**ï¼š
```bash
--num-workers 4        # ä»24é™åˆ°4ï¼ˆæˆ–6ï¼Œç»å¯¹ä¸è¦è¶…è¿‡8ï¼‰
--prefetch-factor 2    # ä»é»˜è®¤å€¼é™åˆ°2
```

**åŸç†**ï¼š
- å‡å°‘åŒæ—¶è®¿é—®ç£ç›˜çš„è¿›ç¨‹æ•°
- 4ä¸ªworkerçš„é¡ºåºè¯»å– > 24ä¸ªworkerçš„éšæœºè¯»å–
- é™ä½ç£ç›˜é˜Ÿåˆ—é•¿åº¦ï¼Œå‡å°‘I/Oç«äº‰

**é¢„æœŸæ•ˆæœ**ï¼š
- I/Oç­‰å¾…æ—¶é—´ä»41-70%é™åˆ°10-20%
- è™½ç„¶å•batchæ—¶é—´å¯èƒ½ä»242mså¢åŠ åˆ°300msï¼Œä½†**15ç§’æ­»å¡ä¼šæ¶ˆå¤±**
- æ•´ä½“è®­ç»ƒæ—¶é—´åè€Œä¼šç¼©çŸ­

### æ–¹æ¡ˆ2ï¼šä½¿ç”¨æœ¬åœ°é«˜é€Ÿå­˜å‚¨ï¼ˆå¦‚æœæœ‰ï¼‰

å¦‚æœæœåŠ¡å™¨æœ‰ `/tmp` æˆ– `/scratch` ç›®å½•ï¼ˆé€šå¸¸æ˜¯NVMe SSDï¼‰ï¼š

```bash
# 1. æ£€æŸ¥æ˜¯å¦æœ‰é«˜é€Ÿå­˜å‚¨
df -h /tmp /scratch

# 2. å¦‚æœæœ‰ï¼Œå¤åˆ¶éƒ¨åˆ†æ•°æ®åˆ°æœ¬åœ°
cp -r /home/team/zouzhiyuan/dataset/sa1b_tar_shards/* /tmp/sa1b_tar_shards/

# 3. è®­ç»ƒæ—¶ä½¿ç”¨æœ¬åœ°è·¯å¾„
--data-dir /tmp/sa1b_tar_shards
```

### æ–¹æ¡ˆ3ï¼šæ¸…ç†ç£ç›˜ç©ºé—´ï¼ˆé•¿æœŸä¼˜åŒ–ï¼‰

```bash
# æ£€æŸ¥å¤§æ–‡ä»¶
du -sh /home/team/zouzhiyuan/* | sort -h | tail -10

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶ã€æ—§checkpointç­‰
```

### æ–¹æ¡ˆ4ï¼šä»£ç çº§ä¼˜åŒ–ï¼ˆå·²å®ç°ï¼‰

å·²åœ¨ `train_adapter_align.py` ä¸­å®ç°ï¼š
- âœ… å›¾åƒLRUç¼“å­˜ï¼ˆå‡å°‘é‡å¤è¯»å–ï¼‰
- âœ… NPZç´¢å¼•é¢„åŠ è½½ï¼ˆå‡å°‘æ–‡ä»¶æ‰“å¼€æ¬¡æ•°ï¼‰
- âœ… mmapæ¨¡å¼è¯»å–ï¼ˆå‡å°‘å†…å­˜æ‹·è´ï¼‰
- âœ… å¢åŠ prefetch_factorå‚æ•°

## ğŸ¯ ç«‹å³è¡ŒåŠ¨

**åœæ­¢å½“å‰è®­ç»ƒï¼Œä½¿ç”¨ä»¥ä¸‹å‚æ•°é‡å¯**ï¼š

```bash
python tools/train_adapter_align.py \
    --npz_dir /path/to/npz \
    --images_dir /path/to/images \
    --num_workers 4 \
    --prefetch_factor 2 \
    --image_cache_size 128 \
    ... (å…¶ä»–å‚æ•°)
```

æˆ–è€…å¦‚æœæ˜¯ `train_distill_single_test.py`ï¼š

```bash
python tools/core/exper/train_distill_single_test.py \
    --num-workers 4 \
    --prefetch-factor 2 \
    --data-format tar_shard \
    ... (å…¶ä»–å‚æ•°)
```

## ğŸ“ˆ é¢„æœŸæ”¹å–„

- **I/Oç­‰å¾…æ—¶é—´**: ä» 41-70% â†’ 10-20%
- **ç³»ç»Ÿè´Ÿè½½**: ä» 136 â†’ 80-100
- **è®­ç»ƒç¨³å®šæ€§**: æ¶ˆé™¤15ç§’æ­»å¡
- **æ•´ä½“è®­ç»ƒé€Ÿåº¦**: æå‡20-40%

