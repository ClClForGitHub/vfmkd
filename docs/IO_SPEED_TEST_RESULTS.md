# 磁盘I/O速度测试结果

## 📊 测试结果

### 1. 顺序读取速度（大块连续读取）
```bash
dd if=sa1b_shard_00000.tar of=/dev/null bs=1M count=500
```
- **结果**: 447-486 MB/s ✅
- **评价**: 速度正常，说明磁盘本身性能还可以

### 2. 随机读取速度（模拟训练时的tar内NPZ访问）
```python
# 从tar文件中随机读取100个NPZ文件
```
- **结果**: 178.6 MB/s ⚠️
- **评价**: 比顺序读取慢约60%，但仍在可接受范围

### 3. 之前观察到的极慢速度（4-5 MB/s）
- **可能原因**:
  1. **多进程竞争**: 24个worker同时访问磁盘，导致I/O竞争
  2. **磁盘碎片化**: 97%使用率导致文件碎片化
  3. **其他进程占用**: 系统中有多个训练任务同时运行

## 🔍 分析

### 磁盘性能评估
- **顺序读取**: 447-486 MB/s → 磁盘硬件性能正常
- **随机读取**: 178.6 MB/s → 可接受，但多进程时会显著下降
- **多进程并发**: 24个worker同时访问 → 实际速度可能降到 10-50 MB/s

### 瓶颈原因
1. **I/O竞争**: 多个worker同时访问tar文件，导致磁头频繁寻道
2. **磁盘队列**: 队列长度225，说明大量请求在排队
3. **文件系统缓存**: 虽然OS有缓存，但多进程随机访问时缓存命中率低

## ✅ 优化建议

### 立即优化（推荐）
```bash
--num-workers 4        # 降低并发数，减少I/O竞争
--prefetch-factor 2    # 减少预取，避免队列堆积
```

### 预期效果
- **单进程速度**: 178.6 MB/s
- **4进程并发**: 预计 50-80 MB/s（每个进程）
- **24进程并发**: 预计 10-20 MB/s（每个进程）← 这就是瓶颈！

### 结论
**磁盘本身速度还可以，但多进程并发时性能急剧下降。降低worker数量是最有效的解决方案。**




